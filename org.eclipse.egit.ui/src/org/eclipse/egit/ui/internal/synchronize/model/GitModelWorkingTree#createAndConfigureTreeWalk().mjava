	@Override
	protected TreeWalk createAndConfigureTreeWalk() throws IOException {
		TreeWalk tw = createTreeWalk();
		tw.setRecursive(true);

		Repository repo = getRepository();
		dirCacheIteratorNth = tw.addTree(new DirCacheIterator(repo.readDirCache()));
		int ftIndex = tw.addTree(new FileTreeIterator(repo));
		IndexDiffFilter idf = new IndexDiffFilter(dirCacheIteratorNth, ftIndex, true);
		tw.setFilter(idf);

		return tw;
	}

