	private void createCreateBranchItem(Menu men, final RepositoryTreeNode node) {

		final boolean remoteMode;
		final Ref ref;
		if (node.getType() == RepositoryTreeNodeType.REF) {
			remoteMode = node.getParent().getType() == RepositoryTreeNodeType.REMOTEBRANCHES;
			ref = (Ref) node.getObject();
		} else if (node.getType() == RepositoryTreeNodeType.LOCALBRANCHES) {
			remoteMode = false;
			ref = null;
		} else if (node.getType() == RepositoryTreeNodeType.REMOTEBRANCHES) {
			remoteMode = true;
			ref = null;
		} else
			return;

		MenuItem createLocal = new MenuItem(men, SWT.PUSH);
		if (remoteMode)
			createLocal.setText(UIText.RepositoriesView_NewRemoteBranchMenu);
		else
			createLocal.setText(UIText.RepositoriesView_NewLocalBranchMenu);

		createLocal.addSelectionListener(new SelectionAdapter() {

			@Override
			public void widgetSelected(SelectionEvent e) {

				Wizard wiz = new Wizard() {

					@Override
					public void addPages() {
						addPage(new CreateBranchPage(node.getRepository(), ref,
								remoteMode));
						setWindowTitle(UIText.RepositoriesView_NewBranchTitle);
					}

					@Override
					public boolean performFinish() {

						try {
							getContainer().run(false, true,
									new IRunnableWithProgress() {

										public void run(IProgressMonitor monitor)
												throws InvocationTargetException,
												InterruptedException {
											CreateBranchPage cp = (CreateBranchPage) getPages()[0];
											try {
												cp.createBranch(monitor);
											} catch (CoreException ce) {
												throw new InvocationTargetException(
														ce);
											} catch (IOException ioe) {
												throw new InvocationTargetException(
														ioe);
											}

										}
									});
						} catch (InvocationTargetException ite) {
							Activator
									.handleError(
											UIText.RepositoriesView_BranchCreationFailureMessage,
											ite.getCause(), true);
							return false;
						} catch (InterruptedException ie) {
							// ignore here
						}
						return true;
					}
				};
				if (new WizardDialog(getSite().getShell(), wiz).open() == Window.OK)
					scheduleRefresh();
			}

		});

	}

