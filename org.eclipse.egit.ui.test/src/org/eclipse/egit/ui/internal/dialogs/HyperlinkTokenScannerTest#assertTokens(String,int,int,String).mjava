	private void assertTokens(String text, int offset, int length,
			String expected) {
		assertEquals("Test definition problem: 'expected' length mismatch",
				text.length(), expected.length());
		IDocument testDocument = new Document(text);
		when(viewer.getDocument()).thenReturn(testDocument);
		HyperlinkTokenScanner scanner = new HyperlinkTokenScanner(detectors,
				viewer);
		scanner.setRangeAndColor(testDocument, offset, length, null);
		IToken token = null;
		char[] found = new char[text.length()];
		Arrays.fill(found, ' ');
		while (!(token = scanner.nextToken()).isEOF()) {
			int tokenOffset = scanner.getTokenOffset();
			int tokenLength = scanner.getTokenLength();
			char ch = 'x';
			if (token == HyperlinkTokenScanner.DEFAULT) {
				ch = 'D';
			} else {
				Object data = token.getData();
				if (data instanceof TextAttribute) {
					int style = ((TextAttribute) data).getStyle();
					if ((style & TextAttribute.UNDERLINE) != 0) {
						ch = 'H';
					}
				}
			}
			Arrays.fill(found, tokenOffset, tokenOffset + tokenLength, ch);
		}
		assertEquals("Unexpected tokens", expected, new String(found));
	}

