	@Test
	public void testCheckoutRemote() throws Exception {
		SWTBotPerspective perspective = null;
		IJobChangeListener listener = null;
		try {
			perspective = bot.activePerspective();
			bot.perspectiveById("org.eclipse.pde.ui.PDEPerspective").activate();
			clearView();
			Activator.getDefault().getRepositoryUtil().addConfiguredRepository(
					clonedRepositoryFile);
			shareProjects(clonedRepositoryFile);
			refreshAndWait();

			SWTBotTree tree = getOrOpenView().bot().tree();

			SWTBotTreeItem item = getLocalBranchesItem(tree,
					clonedRepositoryFile).expand();

			List<String> children = item.getNodes();
			assertEquals("Wrong number of local children", 2, children.size());

			// make sure to checkout master
			item.getNode(0).select();
			ContextMenuHelper.clickContextMenu(tree, myUtil
					.getPluginLocalizedValue("CheckoutCommand"));
			refreshAndWait();
			touchAndSubmit();
			refreshAndWait();

			item = getRemoteBranchesItem(tree, clonedRepositoryFile).expand();
			children = item.getNodes();
			assertEquals("Wrong number of remote children", 2, children.size());

			final boolean[] done = new boolean[] { false };

			final String jobName = NLS.bind(
					UIText.RepositoriesView_CheckingOutMessage,
					"refs/remotes/origin/stable");

			listener = new JobChangeAdapter() {

				@Override
				public void done(IJobChangeEvent event) {
					if (jobName.equals(event.getJob().getName()))
						done[0] = true;
				}

			};

			Job.getJobManager().addJobChangeListener(listener);

			item.getNode("origin/stable").select();
			ContextMenuHelper.clickContextMenu(tree, myUtil
					.getPluginLocalizedValue("CheckoutCommand"));
			refreshAndWait();

			for (int i = 0; i < 1000; i++) {
				if (done[0])
					break;
				Thread.sleep(10);
			}

			GitLightweightDecorator.refresh();

			assertTrue("Branch should not be symbolic", ObjectId
					.isId(lookupRepository(clonedRepositoryFile).getBranch()));

			// now let's try to create a local branch from the remote one
			item = getRemoteBranchesItem(tree, clonedRepositoryFile).expand();
			item.getNode("origin/stable").select();
			ContextMenuHelper.clickContextMenu(tree, myUtil
					.getPluginLocalizedValue("CreateBranchCommand"));

			SWTBotShell createPage = bot
					.shell(UIText.RepositoriesView_NewBranchTitle);
			createPage.activate();
			assertEquals("Wrong suggested branch name", "stable", createPage
					.bot().text(1).getText());
			createPage.close();

		} finally {
			if (perspective != null)
				perspective.activate();
			if (listener != null)
				Job.getJobManager().removeJobChangeListener(listener);
		}
	}

